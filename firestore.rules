rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {
    
    // Fungsi ini adalah jantung dari keamanan Anda.
    // Ia memeriksa apakah permintaan (request) yang masuk ke Firestore
    // membawa informasi autentikasi yang valid. Jika ya, pengguna dianggap admin.
    function isAdmin() {
      return request.auth != null;
    }

    // Aturan untuk koleksi "articles"
    // 'allow read: if true;' berarti siapa saja, bahkan pengunjung anonim,
    // dapat melihat data artikel. Ini penting untuk portal publik Anda.
    // 'allow write: if isAdmin();' berarti hanya pengguna yang sudah login
    // yang dapat membuat, mengubah, atau menghapus artikel.
    match /articles/{articleId} {
      allow read: if true;
      allow write: if isAdmin();
    }

    // Aturan untuk koleksi "galleryImages"
    // Sama seperti artikel, galeri bisa dilihat oleh siapa saja.
    // Namun, hanya admin yang bisa menambahkan atau menghapus gambar.
    match /galleryImages/{imageId} {
      allow read: if true;
      allow create, delete: if isAdmin();
    }

    // Aturan Penutup (Sangat Penting untuk Keamanan)
    // Aturan ini secara eksplisit menolak semua akses baca dan tulis
    // ke koleksi lain yang mungkin Anda buat di masa depan secara tidak sengaja.
    // Ini adalah prinsip keamanan "least privilege".
    match /{document=**} {
      allow read, write: if false;
    }
  }
}
